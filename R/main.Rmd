---
title: "BAG3 Co-IP MS Analysis"
author: "Emir Turkes"
date: '`r strftime(Sys.time(), format = "%B %d, %Y")`'
output:
    html_document:
        number_sections: true
        theme: lumen
        toc: true
        toc_float:
            collapsed: false
            smooth_scroll: false
knit: (
    function(inputFile, encoding) {
        rmarkdown::render(
            inputFile,
            encoding = encoding,
            output_file = "../results/bag3-co-ip-analysis.html"
            )
        }
    )
---

```{r setup, include = FALSE}
#    This file is part of bag3-co-ip.
#    Copyright (C) 2019  Emir Turkes
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
#    Emir Turkes can be contacted at eturkes@bu.edu

knitr::opts_chunk$set(echo = TRUE)
```

<style type="text/css">

body{ /* Normal  */
  font-size: 16px;
}
h1.title {
  font-size: 35px;
}
h1 { /* Header 1 */
  font-size: 24px;
}
h2 { /* Header 2 */
  font-size: 22px;
}
h3 { /* Header 3 */
  font-size: 20px;
}
.toc-content {
  padding-left: 0px;
  padding-right: 0px;
}
div.tocify {
  width: 100%;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
  padding-left: 25px;
  text-indent: 0;
}
.tocify-subheader .tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 35px;
  text-indent: 0;
}
div.main-container {
  max-width: none;
  width: 100%;
}

</style>

*This is a broad analysis that prepares and characterizes the data to answer more specific questions in other projects and is intended to be imported as a Git submodule in those repositories.*

The background for this data is as follows:

- Co-IP MS (co-immunoprecipitation mass spectrometry) using BAG3 as bait.
- scrRNA control and shBAG3 to knockdown BAG3 to examine BAG3 specific interactions.
- Approximately 90% efficient knockdown.
- Single replicate of mature rat primary cortical neurons (DIV 24).

# Final Results

If you are not interested in the methods leading to the final results of this analysis, just check this section.
Otherwise, continue on.

# Raw Data

First, let's take a look at the raw data output from Proteome Discoverer. The data is unmodified but some columns have been lightly edited outside of R for easier import.

```{r raw_data, include = TRUE, echo = TRUE}
dt <- data.table::data.table(readxl::read_excel(
    "../proteome-discoverer/Ji_ProteinReport-ProteinReport_17-155-edited.xlsx"
    )
)

eturkesRutils::datatable(dt)
```

# Basic Cleaning

Next, we do some very basic modifications that affect the presentation of the data but make no alterations to the data itself (aside from basic transformation) nor produce new data.
In best case scenarios, these modifications are enough to conclude a project of this scope.

```{r basic_cleaning, include = TRUE, echo = TRUE}
# Rename and reduce columns.
cols <- c("Genes", "Abundance Ratio: Scr/SH", "scrRNA Abundance", "shBAG3 Abundance")
dt <- plyr::rename(dt,
                   c("Description" = cols[1],
                     "Summed Abundance Ratio (log2): (Scr) / (SH)" = cols[2],
                     "Scr Abundances" = cols[3],
                     "SH Abundances" = cols[4])
)
dt <- dt[, cols, with = FALSE]

# Extract gene names from the "Genes" column, removing entries that lack a name.
# This is only an intermediary step, the column of genes are then fed into IBM Watson and converted
# into Watson entities.
# The column of genes are then replaced with the Watson entities to facilitate easy comparison.
# This is done manually, as there is currently no Watson for Drug Discovery API.
dt[[cols[1]]] <- stringr::str_extract(dt[[cols[1]]], "(?<=GN=).*(?= PE=)")
dt <- dt[rowSums(is.na(dt[ , 1]))!=1, ]
watson_genes <- data.table::fread(
    "../watson/EntitySet_bag3-co-ip-basic-clean_2019-04-18_16-41-05.csv"
    )
dt[[cols[1]]] <- watson_genes[["Entity name"]]

eturkesRutils::datatable(dt)
```

## Sort Schemes {.tabset}

We explore the two most relevant sorting schemes:

- Specificity with BAG3
- Abundance of protein

### Specificity with BAG3

```{r specificity_with_bag3, include = TRUE, echo = TRUE}
dt_spec <- dt[order(-dt[[cols[2]]], dt[[cols[4]]]), ]

eturkesRutils::datatable(dt_spec)
```

### Abundance of Protein

```{r abundance_of_protein, include = TRUE, echo = TRUE}
dt_abun <- dt[order(-dt[[cols[3]]], -dt[[cols[4]]]), ]

eturkesRutils::datatable(dt_abun)
```

# Statistical Filtering

Due to several limitations of this dataset, it is unreliable to gleam insights from the results thus far.
Nonetheless, there exists statistical techniques that are suitable for further filtering the data.

## Missing Value Imputation



# Session Info

```{r session_info, include = TRUE, echo = TRUE}
devtools::session_info()
```
